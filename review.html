<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ‹æ–‡æˆèªè¤‡ç¿’ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: #f5f5f5;
            border: none;
            font-size: 1.2em;
            font-weight: bold;
            color: #666;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab:hover {
            background: #e8e8e8;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 40px;
        }

        .tab-content.active {
            display: block;
        }

        /* è¤‡ç¿’é é¢æ¨£å¼ */
        .review-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .idiom-image {
            width: 100%;
            max-width: 400px;
            height: 300px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .idiom-text {
            font-size: 3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .meaning {
            font-size: 1.5em;
            color: #555;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            margin-top: 20px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .meaning.hidden {
            opacity: 0;
            transform: translateY(-10px);
        }

        .meaning.visible {
            opacity: 1;
            transform: translateY(0);
            transition: all 0.5s ease;
        }

        .buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.2em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(245, 87, 108, 0.4);
        }

        .progress-container {
            margin-top: 30px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 10px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.1em;
            color: #666;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* ç®¡ç†é é¢æ¨£å¼ */
        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            font-family: 'Microsoft JhengHei', 'Arial', sans-serif;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            width: 100%;
        }

        .btn-add {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 15px 50px;
            font-size: 1.2em;
            flex: 1;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(17, 153, 142, 0.4);
        }

        .confirm-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .confirm-btn:hover {
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.4);
        }

        .idiom-list {
            margin-top: 40px;
        }

        .idiom-list h2 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.8em;
        }

        .idiom-item {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .idiom-item:hover {
            transform: translateX(5px);
        }

        .idiom-item-content {
            flex: 1;
        }

        .idiom-item-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .idiom-item-meaning {
            color: #666;
            font-size: 1em;
        }

        .idiom-item-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-delete {
            background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
            color: white;
            padding: 10px 25px;
            font-size: 1em;
            border-radius: 8px;
            cursor: pointer;
            border: none;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-delete:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(245, 87, 108, 0.4);
        }

        .btn-edit {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 10px 25px;
            font-size: 1em;
            border-radius: 8px;
            cursor: pointer;
            border: none;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-edit:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(17, 153, 142, 0.4);
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 1.2em;
        }

        /* é€šçŸ¥æ¨£å¼ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #4caf50;
            color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            font-weight: bold;
            opacity: 0;
            transform: translateX(400px);
            transition: all 0.3s ease;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .notification.error {
            background: #f44336;
        }

        .notification.warning {
            background: #ff9800;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š åœ‹æ–‡æˆèªè¤‡ç¿’ç³»çµ±</h1>
            <p>æå‡æˆèªèƒ½åŠ›ï¼Œè¼•é¬†å­¸ç¿’</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('review')">è¤‡ç¿’æˆèª</button>
            <button class="tab" onclick="switchTab('manage')">ç®¡ç†æˆèª</button>
        </div>

        <!-- è¤‡ç¿’é é¢ -->
        <div id="review" class="tab-content active">
            <div class="review-card">
                <img id="cardImage" class="idiom-image" src="" alt="æˆèªåœ–ç‰‡">
                <div id="idiomText" class="idiom-text"></div>
                <div id="meaning" class="meaning hidden"></div>
            </div>

            <div class="buttons">
                <button class="btn btn-primary" onclick="showAnswer()">é¡¯ç¤ºç­”æ¡ˆ</button>
                <button class="btn btn-secondary" onclick="nextIdiom()">ä¸‹ä¸€å€‹</button>
            </div>

            <div class="progress-container">
                <div class="progress-info">
                    <span>é€²åº¦</span>
                    <span id="progressText">0 / 0</span>
                </div>
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill" style="width: 0%">0%</div>
                </div>
            </div>
        </div>

        <!-- ç®¡ç†é é¢ -->
        <div id="manage" class="tab-content">
            <form id="addForm" class="add-word-form" onsubmit="addIdiom(event)">
                <div class="form-group">
                    <label for="idiomName">æˆèªåç¨±ï¼š</label>
                    <input type="text" id="idiomName" placeholder="ä¾‹å¦‚ï¼šç•«é¾é»ç›" required>
                </div>

                <div class="form-group">
                    <label for="idiomImageUrl">åœ–ç‰‡ç¶²å€ï¼š</label>
                    <input type="url" id="idiomImageUrl" placeholder="https://example.com/image.jpg" required>
                </div>

                <div class="form-group">
                    <label for="newImage">ä¸Šå‚³åœ–ç‰‡ï¼š</label>
                    <input type="file" id="newImage" accept="image/*">
                </div>

                <div class="form-group">
                    <label for="idiomMeaning">ä¸­æ–‡æ„æ€ï¼š</label>
                    <textarea id="idiomMeaning" placeholder="ä¾‹å¦‚ï¼šæ¯”å–»åœ¨é—œéµè™•åŠ ä¸Šä¸€ç­†ï¼Œä½¿æ•´é«”æ›´ç‚ºç”Ÿå‹•ç²¾å½©" required></textarea>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-add add-btn">â• æ–°å¢æˆèª</button>
                    <button type="button" class="btn btn-add add-btn confirm-btn">ç¢ºå®š</button>
                </div>
            </form>

            <div class="idiom-list">
                <h2>æˆèªåˆ—è¡¨</h2>
                <div id="idiomListContainer">
                    <!-- æˆèªåˆ—è¡¨å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥å…ƒç´  -->
    <div id="notification" class="notification"></div>

    <script>
        // LocalStorage çš„éµå
        const STORAGE_KEY = 'vocabulary';

        // é è¨­æˆèªæ•¸æ“š
        const defaultVocabulary = [
            {
                word: 'ç•«é¾é»ç›',
                meaning: 'æ¯”å–»åœ¨é—œéµè™•åŠ ä¸Šä¸€ç­†ï¼Œä½¿æ•´é«”æ›´ç‚ºç”Ÿå‹•ç²¾å½©ã€‚å‡ºè‡ªå¼µåƒ§ç¹‡ç•«é¾çš„æ•…äº‹ã€‚',
                image: 'images/dragon_eye.png'
            },
            {
                word: 'å®ˆæ ªå¾…å…”',
                meaning: 'æ¯”å–»ä¸çŸ¥è®Šé€šï¼Œå¦„æƒ³ä¸å‹è€Œç²ã€‚æŒ‡æ­»å®ˆç¶“é©—ï¼Œä¸çŸ¥éˆæ´»æ‡‰è®Šã€‚',
                image: 'images/tree_rabbit.png'
            },
            {
                word: 'åˆ»èˆŸæ±‚åŠ',
                meaning: 'æ¯”å–»æ‹˜æ³¥å›ºåŸ·ï¼Œä¸çŸ¥è®Šé€šã€‚ç”¨éœæ­¢çš„çœ¼å…‰çœ‹å¾…è®ŠåŒ–çš„å•é¡Œã€‚',
                image: 'images/boat_sword.png'
            },
            {
                word: 'æ©è€³ç›œéˆ´',
                meaning: 'æ¯”å–»è‡ªæ¬ºæ¬ºäººï¼Œä»¥ç‚ºéš±çäº‹å¯¦å°±å¯ä»¥è§£æ±ºå•é¡Œã€‚è‡ªå·±æ¬ºé¨™è‡ªå·±ã€‚',
                image: 'images/cover_ear_bell.png'
            },
            {
                word: 'äº•åº•ä¹‹è›™',
                meaning: 'æ¯”å–»è¦‹è­˜æ·ºé™‹ï¼Œä¸çŸ¥é“å¤–é¢ä¸–ç•Œçš„å»£é—Šã€‚å½¢å®¹äººç›®å…‰çŸ­æ·ºï¼Œè¦‹è­˜æœ‰é™ã€‚',
                image: 'images/well_frog.png'
            }
        ];

        // æˆèªæ•¸æ“šé™£åˆ—ï¼ˆå¾ LocalStorage è®€å–ï¼‰
        let vocabulary = [];

        // ç•¶å‰è¤‡ç¿’çš„æˆèªç´¢å¼•
        let currentIndex = 0;

        // ç·¨è¼¯ç‹€æ…‹è®Šæ•¸
        let editingIndex = -1; // -1 è¡¨ç¤ºæ–°å¢æ¨¡å¼ï¼Œ>= 0 è¡¨ç¤ºç·¨è¼¯æ¨¡å¼çš„ç´¢å¼•

        // å¾ LocalStorage è®€å–æˆèªåˆ—è¡¨
        function loadVocabularyFromStorage() {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    vocabulary = JSON.parse(stored);
                } else {
                    // å¦‚æœ LocalStorage ä¸­æ²’æœ‰è³‡æ–™ï¼Œä½¿ç”¨é è¨­è³‡æ–™ä¸¦å„²å­˜
                    vocabulary = [...defaultVocabulary];
                    saveVocabularyToStorage();
                }
            } catch (error) {
                console.error('è®€å– LocalStorage å¤±æ•—:', error);
                // å¦‚æœè®€å–å¤±æ•—ï¼Œä½¿ç”¨é è¨­è³‡æ–™
                vocabulary = [...defaultVocabulary];
                saveVocabularyToStorage();
            }
        }

        // å°‡æˆèªåˆ—è¡¨å„²å­˜åˆ° LocalStorage
        function saveVocabularyToStorage() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(vocabulary));
            } catch (error) {
                console.error('å„²å­˜åˆ° LocalStorage å¤±æ•—:', error);
                showNotification('è³‡æ–™å„²å­˜å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨è¨­å®š', 'error');
            }
        }

        // æ¨™ç±¤åˆ‡æ›åŠŸèƒ½
        function switchTab(tabName) {
            // éš±è—æ‰€æœ‰æ¨™ç±¤å…§å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // ç§»é™¤æ‰€æœ‰æ¨™ç±¤æŒ‰éˆ•çš„ active ç‹€æ…‹
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // é¡¯ç¤ºé¸ä¸­çš„æ¨™ç±¤å…§å®¹
            document.getElementById(tabName).classList.add('active');

            // ç‚ºé¸ä¸­çš„æ¨™ç±¤æŒ‰éˆ•æ·»åŠ  active ç‹€æ…‹
            event.target.classList.add('active');

            // å¦‚æœåˆ‡æ›åˆ°ç®¡ç†é é¢ï¼Œæ›´æ–°åˆ—è¡¨
            if (tabName === 'manage') {
                renderIdiomList();
            }

            // å¦‚æœåˆ‡æ›åˆ°è¤‡ç¿’é é¢ï¼Œé‡æ–°è¼‰å…¥ç•¶å‰æˆèª
            if (tabName === 'review') {
                updateCard();
            }
        }

        // æ›´æ–°æˆèªå¡ (updateCard å‡½å¼)
        function updateCard() {
            if (vocabulary.length === 0) {
                document.getElementById('idiomText').textContent = 'æš«ç„¡æˆèª';
                document.getElementById('cardImage').src = '';
                document.getElementById('meaning').textContent = '';
                document.getElementById('meaning').classList.add('hidden');
                updateProgress();
                return;
            }

            const currentIdiom = vocabulary[currentIndex];
            document.getElementById('idiomText').textContent = currentIdiom.word;
            // æ ¹æ“šç•¶å‰æˆèªçš„ image å±¬æ€§å€¼ä¾†æ›´æ–°åœ–ç‰‡
            if (currentIdiom.image && currentIdiom.image.trim() !== '') {
                document.getElementById('cardImage').src = currentIdiom.image;
                document.getElementById('cardImage').style.display = 'block';
            } else {
                // å¦‚æœæ²’æœ‰åœ–ç‰‡ï¼Œéš±è—åœ–ç‰‡å…ƒç´ æˆ–é¡¯ç¤ºé è¨­åœ–ç‰‡
                document.getElementById('cardImage').src = '';
                document.getElementById('cardImage').style.display = 'none';
            }
            document.getElementById('meaning').textContent = currentIdiom.meaning;
            document.getElementById('meaning').classList.add('hidden');
            updateProgress();
        }

        // é¡¯ç¤ºç­”æ¡ˆ
        function showAnswer() {
            if (vocabulary.length === 0) {
                showNotification('ç›®å‰æ²’æœ‰æˆèªå¯ä»¥è¤‡ç¿’', 'warning');
                return;
            }
            const meaningElement = document.getElementById('meaning');
            meaningElement.classList.remove('hidden');
            meaningElement.classList.add('visible');
        }

        // ä¸‹ä¸€å€‹æˆèª
        function nextIdiom() {
            if (vocabulary.length === 0) {
                showNotification('ç›®å‰æ²’æœ‰æˆèªå¯ä»¥è¤‡ç¿’', 'warning');
                return;
            }

            // å¾ªç’°åˆ°ä¸‹ä¸€å€‹æˆèª
            currentIndex = (currentIndex + 1) % vocabulary.length;
            updateCard();
        }

        // æ›´æ–°é€²åº¦
        function updateProgress() {
            if (vocabulary.length === 0) {
                document.getElementById('progressText').textContent = '0 / 0';
                document.getElementById('progressFill').style.width = '0%';
                document.getElementById('progressFill').textContent = '0%';
                return;
            }

            const progress = ((currentIndex + 1) / vocabulary.length) * 100;
            document.getElementById('progressText').textContent = `${currentIndex + 1} / ${vocabulary.length}`;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressFill').textContent = `${Math.round(progress)}%`;
        }

        // ä¿®æ”¹æˆèªï¼ˆå°‡è³‡æ–™å¡«å…¥è¡¨å–®ï¼‰
        function editIdiom(index) {
            const idiom = vocabulary[index];
            editingIndex = index;

            // å°‡è³‡æ–™å¡«å…¥è¡¨å–®
            document.getElementById('idiomName').value = idiom.word;
            document.getElementById('idiomMeaning').value = idiom.meaning;
            document.getElementById('idiomImageUrl').value = idiom.image && idiom.image.startsWith('http') ? idiom.image : '';
            
            // å¦‚æœåœ–ç‰‡æ˜¯ Base64ï¼Œç„¡æ³•ç›´æ¥é¡¯ç¤ºåœ¨æª”æ¡ˆè¼¸å…¥ä¸­ï¼Œæ‰€ä»¥æ¸…ç©ºæª”æ¡ˆè¼¸å…¥
            document.getElementById('newImage').value = '';

            // æ›´æ–°æŒ‰éˆ•æ–‡å­—
            const submitBtn = document.querySelector('.add-btn[type="submit"]');
            const confirmBtn = document.querySelector('.confirm-btn');
            if (submitBtn) submitBtn.textContent = 'âœï¸ æ›´æ–°æˆèª';
            if (confirmBtn) confirmBtn.textContent = 'ç¢ºå®šæ›´æ–°';

            // æ»¾å‹•åˆ°è¡¨å–®
            document.getElementById('addForm').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // æ–°å¢/æ›´æ–°æˆèª
        function addIdiom(event) {
            event.preventDefault();

            const name = document.getElementById('idiomName').value.trim();
            const imageUrl = document.getElementById('idiomImageUrl').value.trim();
            const meaning = document.getElementById('idiomMeaning').value.trim();
            const imageFile = document.getElementById('newImage').files[0];

            // æª¢æŸ¥æ©Ÿåˆ¶ï¼šåœ¨å°‡æ–°æˆèªæ¨å…¥é™£åˆ—å‰ï¼Œå…ˆæª¢æŸ¥ vocabulary é™£åˆ—ä¸­æ˜¯å¦å·²å­˜åœ¨ç›¸åŒçš„æˆèª
            // ç·¨è¼¯æ¨¡å¼ä¸‹ï¼Œæ’é™¤è‡ªå·±
            const isEditMode = editingIndex >= 0;
            const hasDuplicate = vocabulary.some((idiom, idx) => 
                idiom.word === name && (!isEditMode || idx !== editingIndex)
            );

            if (hasDuplicate) {
                // å¦‚æœé‡è¤‡ï¼Œé¡¯ç¤ºè­¦å‘Šé€šçŸ¥ï¼Œä¸¦å–æ¶ˆæ–°å¢
                showNotification(`æˆèªã€Œ${name}ã€å·²å­˜åœ¨ï¼Œç„¡æ³•æ–°å¢é‡è¤‡çš„æˆèªï¼`, 'warning');
                return;
            }

            // è™•ç†åœ–ç‰‡ï¼šå„ªå…ˆä½¿ç”¨ä¸Šå‚³çš„æª”æ¡ˆï¼Œå…¶æ¬¡ä½¿ç”¨åœ–ç‰‡ç¶²å€ï¼Œæœ€å¾Œä½¿ç”¨åŸæœ‰åœ–ç‰‡ï¼ˆç·¨è¼¯æ¨¡å¼ï¼‰
            if (imageFile) {
                // ä½¿ç”¨ FileReader å°‡åœ–ç‰‡è½‰æ›ç‚º Base64 æ ¼å¼
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    // Base64 å­—ä¸²åœ¨ e.target.result ä¸­
                    const base64Image = e.target.result;

                    // æ–°å¢æˆ–æ›´æ–°æˆèª
                    const idiomData = {
                        word: name,
                        meaning: meaning,
                        image: base64Image
                    };

                    if (isEditMode) {
                        vocabulary[editingIndex] = idiomData;
                        showNotification('æˆèªæ›´æ–°æˆåŠŸï¼', 'success');
                    } else {
                        vocabulary.push(idiomData);
                        showNotification('æˆèªæ–°å¢æˆåŠŸï¼', 'success');
                    }

                    // å„²å­˜åˆ° LocalStorage
                    saveVocabularyToStorage();

                    // é‡ç½®è¡¨å–®å’Œç·¨è¼¯ç‹€æ…‹
                    resetForm();

                    // æ›´æ–°åˆ—è¡¨
                    renderIdiomList();

                    // å¦‚æœç•¶å‰åœ¨è¤‡ç¿’é é¢ï¼Œé‡æ–°è¼‰å…¥
                    if (document.getElementById('review').classList.contains('active')) {
                        updateCard();
                    }
                };

                reader.onerror = function() {
                    showNotification('åœ–ç‰‡è®€å–å¤±æ•—ï¼Œè«‹é‡è©¦', 'error');
                };

                // è®€å–æª”æ¡ˆä¸¦è½‰æ›ç‚º Base64
                reader.readAsDataURL(imageFile);
            } else {
                // æ²’æœ‰ä¸Šå‚³åœ–ç‰‡ï¼Œä½¿ç”¨åœ–ç‰‡ç¶²å€æˆ–åŸæœ‰åœ–ç‰‡
                let finalImage = imageUrl || '';
                if (isEditMode && !imageUrl) {
                    // ç·¨è¼¯æ¨¡å¼ä¸‹ï¼Œå¦‚æœæ²’æœ‰è¼¸å…¥æ–°åœ–ç‰‡ç¶²å€ï¼Œä¿ç•™åŸæœ‰åœ–ç‰‡
                    finalImage = vocabulary[editingIndex].image || '';
                }

                const idiomData = {
                    word: name,
                    meaning: meaning,
                    image: finalImage
                };

                // æ–°å¢æˆ–æ›´æ–°æˆèª
                if (isEditMode) {
                    vocabulary[editingIndex] = idiomData;
                    showNotification('æˆèªæ›´æ–°æˆåŠŸï¼', 'success');
                } else {
                    vocabulary.push(idiomData);
                    showNotification('æˆèªæ–°å¢æˆåŠŸï¼', 'success');
                }

                // å„²å­˜åˆ° LocalStorage
                saveVocabularyToStorage();

                // é‡ç½®è¡¨å–®å’Œç·¨è¼¯ç‹€æ…‹
                resetForm();

                // æ›´æ–°åˆ—è¡¨
                renderIdiomList();

                // å¦‚æœç•¶å‰åœ¨è¤‡ç¿’é é¢ï¼Œé‡æ–°è¼‰å…¥
                if (document.getElementById('review').classList.contains('active')) {
                    updateCard();
                }
            }
        }

        // é‡ç½®è¡¨å–®å’Œç·¨è¼¯ç‹€æ…‹
        function resetForm() {
            document.getElementById('addForm').reset();
            editingIndex = -1;
            
            // æ¢å¾©æŒ‰éˆ•æ–‡å­—
            const submitBtn = document.querySelector('.add-btn[type="submit"]');
            const confirmBtn = document.querySelector('.confirm-btn');
            if (submitBtn) submitBtn.textContent = 'â• æ–°å¢æˆèª';
            if (confirmBtn) confirmBtn.textContent = 'ç¢ºå®š';
        }

        // åˆªé™¤æˆèª
        function deleteIdiom(index) {
            if (confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${vocabulary[index].word}ã€å—ï¼Ÿ`)) {
                vocabulary.splice(index, 1);

                // å„²å­˜åˆ° LocalStorage
                saveVocabularyToStorage();

                // å¦‚æœåˆªé™¤å¾Œç´¢å¼•è¶…å‡ºç¯„åœï¼Œèª¿æ•´ç•¶å‰ç´¢å¼•
                if (currentIndex >= vocabulary.length && vocabulary.length > 0) {
                    currentIndex = 0;
                }

                // æ›´æ–°åˆ—è¡¨
                renderIdiomList();

                // å¦‚æœåœ¨è¤‡ç¿’é é¢ï¼Œé‡æ–°è¼‰å…¥
                if (document.getElementById('review').classList.contains('active')) {
                    updateCard();
                }

                showNotification('æˆèªå·²åˆªé™¤', 'success');
            }
        }

        // æ¸²æŸ“æˆèªåˆ—è¡¨
        function renderIdiomList() {
            const container = document.getElementById('idiomListContainer');

            if (vocabulary.length === 0) {
                container.innerHTML = '<div class="empty-state">ç›®å‰æ²’æœ‰ä»»ä½•æˆèªï¼Œè«‹æ–°å¢æˆèªé–‹å§‹ä½¿ç”¨ï¼</div>';
                return;
            }

            container.innerHTML = vocabulary.map((idiom, index) => `
                <div class="idiom-item">
                    <div class="idiom-item-content">
                        <div class="idiom-item-title">${idiom.word}</div>
                        <div class="idiom-item-meaning">${idiom.meaning}</div>
                    </div>
                    <div class="idiom-item-buttons">
                        <button class="btn-edit" onclick="editIdiom(${index})">âœï¸ ä¿®æ”¹</button>
                        <button class="btn-delete" onclick="deleteIdiom(${index})">ğŸ—‘ï¸ åˆªé™¤</button>
                    </div>
                </div>
            `).join('');
        }

        // é¡¯ç¤ºé€šçŸ¥
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // updateWordList å‡½æ•¸ï¼ˆä½œç‚º renderIdiomList çš„åˆ¥åï¼‰
        function updateWordList() {
            renderIdiomList();
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.onload = function() {
            // å¾ LocalStorage è¼‰å…¥æˆèªåˆ—è¡¨
            loadVocabularyFromStorage();
            // è¼‰å…¥ç•¶å‰æˆèªå’Œæ¸²æŸ“åˆ—è¡¨
            updateCard();
            renderIdiomList();

            // ç‚º .confirm-btn æ–°å¢äº‹ä»¶ç›£è½å™¨ï¼ˆè¤‡è£½ addIdiom çš„é‚è¼¯ï¼‰
            const confirmBtn = document.querySelector('.confirm-btn');
            if (confirmBtn) {
                confirmBtn.addEventListener('click', function(event) {
                    event.preventDefault();
                    
                    // ç›´æ¥èª¿ç”¨ addIdiom å‡½æ•¸çš„é‚è¼¯ï¼Œä½†éœ€è¦æ‰‹å‹•è§¸ç™¼
                    // å‰µå»ºä¸€å€‹æ¨¡æ“¬äº‹ä»¶å°è±¡
                    const fakeEvent = { preventDefault: function() {} };
                    addIdiom(fakeEvent);
                });
            }
        };
    </script>
</body>
</html>

